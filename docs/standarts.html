<html>
<head>
    <title>Стандарты кодирования MZZ.cms</title>
    <style type="text/css">
        body { font-family: Arial, Verdana, Tahoma; font-size: 100%; color: black; line-height: 120%; background-color: white; }
        div.example { width: 95%; background-color: #EFEFEF; padding: 10px;
                      border: 5px #FFFFFF solid; }
        div.remark  { width: 80%;  padding: 5px;
                      padding-left: 25px; border: 10px #FFFFFF solid; }
        hr { border: 1px solid #C4C4C4; margin-top: 25px; }
        h3 { font-size: 90%; }
        h2 { font-size: 120%; }
        a { color: #0B5F9D; }
        a:hover { color: #063D64; }
    </style>
</head>
<body>

<h1>Стандарты кодирования</h1>
<hr>
<a href="#main"><b>Главное правило</b></a><br>
<a href="#0">О версии PHP</a><br>
<a href="#1">Отступы</a><br>
<a href="#2">Управляющие структуры</a><br>
<a href="#3">Вызовы функций</a><br>
<a href="#4">Определения функций/классов/методов/свойств</a><br>
<a href="#5">Комментарии</a><br>
<a href="#6">Подключение кода (including)</a><br>
<a href="#7">Тэги PHP-кода</a><br>
<a href="#8">Блок комментариев в заголовке</a><br>
<a href="#9">Примеры URLов</a><br>
<a href="#10">Соглашения об именах</a><br>
<a href="#11">Формат файлов</a><br>
<a href="#12">Шаблоны</a><br>
<!-- End of menu -->
<hr><h2><a name="main">Главное правило</a></h2>
<h3><u>Сначала тест - потом код.</u></h3>


<hr><h2><a name="0">О версии PHP</a></h2>
Используйте только синтаксис PHP5. Его главное отличие от синтаксиса PHP4 - объекты передаются по-умолчанию по ссылке. Используйте для решения задач новые библиотеки PHP5 (SPL, SimpleXML, PDO и т.п.). Приложение
должно работать без ошибок даже при 'error_reporting = E_ALL | E_STRICT'. Исключение - сторонние библиотеки (Smarty, PEAR, SimpleTest).

<hr><h2><a name="1">Отступы</a></h2>

Используйте для отступа 4 пробела, а не табуляцию. Если вы используете Emacs для редактирования кода, вы должны установить indent-tabs-mode в ноль. Ниже приведен пример настройки Emacs для этой цели:

<div class="example">
<pre>
(defun php-mode-hook ()
  (setq tab-width 4
        c-basic-offset 4
        c-hanging-comment-ender-p nil
  	indent-tabs-mode
	(not
	 (and (string-match "\.php$" (buffer-file-name))))))
</pre>
</div>
А это пример конфигурации для редактора VIM:
<div class="example">
<pre>
set expandtab
  set shiftwidth=4
  set tabstop=4
</pre>
</div>

<hr><h2><a name="2">Управляющие структуры</a></h2>

Управляющие структуры включают в себя операторы if, for, while, switch, и др. Ниже приведен пример оформления оператора if, который в этом отношении является самым сложным:
<div class="example">
<pre>
if ((condition1) || (condition2)) {
    action1;
} elseif ((condition3) && (condition4)) {
    action2;
} else {
    defaultaction;
}
</pre>
</div>
Cинтаксис упрощенного if:
<div class="example">
<pre>
$foo = (condition1) ? value1 : value2;
</pre>
</div>
<br>


В управляющих структурах между ключевым словом и открывающей круглой скобкой должен находиться пробел, чтобы отличать их от вызова функций.<br>
<br>
Настойчиво рекомендуется использовать фигурные скобки, даже в том случае, когда их использование не является необходимостью. Использование фигурных скобок увеличивает читабельность кода и уменьшает вероятность логических ошибок при изменении кода.
<br>
<br>


Cинтаксис оператора switch:

<div class="example">
<pre>
switch (condition) {
    case 1:
        action1;
        break;
    case 2:
        action2;
        break;
    default:
        defaultaction;
        break;
}
</pre>
</div>



<hr><h2><a name="3">Вызовы функций</a></h2>

Вызовы функций должны быть написаны без отступв между именем функции, открывающей скобкой и первым параметром. Отступы в виде пробела должны присутствовать после каждой запятой в перечислении параметров. Пробелов также не должно быть между последним параметром, закрывающей скобкой и точкой с запятой. Пример:
<div class="example">
<pre>
$var = foo($bar, $baz, $quux);
</pre>
</div>
Как можно заметить, в примере используются пробелы с двух сторон от знака "=". Если подобные присвоения результатов функций переменным объединяются в блоки, то для повышения читабельности рекомендуется следующий синтаксис:
<div class="example">
<pre>
$short         = foo($bar);
$long_variable = foo($baz);
</pre>
</div>


<hr><h2><a name="4">Определения функций/классов/методов/свойств</a></h2>

Определения функций следуют такому cоглашению:
<div class="example">
<pre>
function fooFunction($arg1, $arg2 = '')
{
    if (condition) {
        statement;
    }
    return $val;
}
</pre>
</div>
Определения классов и методов следуют такому же cоглашению. Свойства класса и методы должны быть определены как public, private, или protected. Использование var, алиас public, для определения свойства класса не допускается.
<div class="example">
<pre>
class foo
{
    public $foo;
    protected $some;
    private $bar = "Default value";

    public function fooFunction($arg1, $arg2 = '')
    {
        if (condition) {
            statement;
        }
        return $val;
    }
}
</pre>
</div>
Аргументы функций со значениями по умолчанию должны находиться в конце списка аргументов. Функции всегда должны возвращать значение, если это возможно в принципе. Чуть более подробный пример:
<div class="example">
<pre>
function connect($dsn, $persistent = false)
{
    if (is_array($dsn)) {
        $dsninfo = $dsn;
    } else {
        $dsninfo = DB::parseDSN($dsn);
    }

    if (!$dsninfo || !$dsninfo['phptype']) {
        return $this->raiseError();
    }

    return true;
}
</pre>
</div>

<hr><h2><a name="5">Комментарии</a></h2>

 Комментарии внутри кода классов должны соответствовать синтаксису комментариев PHPDoc, который напоминает Javadoc. За дополнительной информацией о PHPDoc обращайтесь сюда: <a href="http://www.phpdoc.org/">http://www.phpdoc.org/</a><br>
<br>
Дополнительные комментарии, кроме тех, что предусмотрены PHPDoc, только приветствуются. Основное правило в данном случае - каждая часть кода повышенной сложности должна быть прокомментирована до того, как вы забыли как она работает.<br>
<br>
Никаких сокращений и калек в текстах! Оставьте дефолты для США. Если у слова нет перевода, лучше оставить его в оригинальном английском варианте.
<br>Между словами в тексте комментария ставится один символ "пробел" (примечание: если не требуется его форматирование).
<br>
<br>
Подходят комментарии в стилях C (/* */) и C++ (//). <u>Использование комментариев в стиле Perl/shell (#) не допускается. </u><br>
Комментарии в стиле C (/* */) используются в определении классов, методов, функций, заголовков (список может пополняться), а
в стиле C++ (//) внутри методов, функций и вне конструкций языка.<br>
Для комментирования даже одной конструкции лучше использоваться комментарии в стиле C (/* */), возможно потребуется указать причину этого действия.<br>


<hr><h2><a name="6">Подключение кода (including)</a></h2>

 В тех местах, где вы используете подключение файлов других классов вне зависимости от условий, используйте конструкцию require_once(). Если же подключение файлов зависит от каких-либо условий, то следует использовать include_once(). В этом случае вы всегда будете уверены в том, что файлы подключаются только единожды.
<br>
<div class="remark">
<i><u>Замечание</u>: include_once() и require_once() являются конструкциями, а не функциями. Вам не обязательно использовать скобки вокруг имени файла, который подключается.</i>
</div>

<hr><h2><a name="7">Тэги PHP-кода</a></h2>
Всегда используйте <i>&lt;?php ?&gt;</i> вместо <i>&lt;? ?&gt;</i> для выделения PHP-кода. Это необходимо для обеспечения работы системы на разных операционных системах и с различными настройками.

<hr><h2><a name="8">Блок комментариев в заголовке</a></h2>
Все базовые файлы исходного кода должны содержать следующий ниже блок комментариев в заголовке:

<div class="example">
<pre>
/**
 * $URL$
 *
 * MZZ Content Management System (c) 2006
 * Website : http://www.mzz.ru
 *
 * This program is free software and released under
 * the GNU/GPL License (See /docs/GPL.txt).
 *
 * @link http://www.mzz.ru
 * @version $Id$
*/
</pre>
</div>
При необходимости в шапке можно использовать теги PHPDoc
<hr><h2><a name="9">Примеры URLов</a></h2>
Используйте "example.com" для примеров URLов, как описано в RFC 2606.


<hr><h2><a name="10">Соглашения об именах</a></h2>


В общем случае, имена классов, функций и переменных всегда должны быть "говорящими" для того, чтобы читатель мог сразу понять для чего они используются.
<h3>Классы</h3>

Имена классов должны быть удобочитаемыми и понятными. Избегайте использования аббревиатур там, где это возможно. Имена классов должны начинаться с буквы в нижнем регистре. Иерархия классов также отражается на именах классов, каждый уровень отделяется заглавной буковй. Примеры хороших имен классов:
<br><br>

<div class="example">
<pre>
class <b>core</b> { ..}
class <b>fileResolver</b> {...}
class <b>dbFactory</b> {...}
</pre>
</div>


<h3>Функции и методы</h3>

Функции и методы должны использовать "венгерскую нотацию" (в другом варианте - "верблюжачью" =)). Функции также должны иметь префикс в виде имени пакета для того, чтобы избежать проблем с аналогичными функциями из других пакетов. Первая буква в имени функции должна быть в нижнем регистре, каждая первая буква "слова" в имени функции - в верхнем. Несколько примеров:
<br><br>
<div class="example">
<pre>
class sample
{
    function <b>connect</b>() {...}
    function <b>parseData</b>() {...}
    function <b>getNumbers</b>() {...}
    function <b>xmlParser</b>() {...}
}
</pre>
</div>
<br>

<h3>Константы</h3>
Имена констант всегда должны быть в верхнем регистре с подчеркиваниями для разделения слов. В качестве префикса в именах констант должно использоваться имя класса, в котором они используются. Например, все константы, которые используются в классе DB, начинаются с "DB_".

<h3>Глобальные переменные</h3>
Если в вашем пакете необходимо объявить глобальные переменные, то их имя должно начинаться с подчеркивания, имени пакета и еще одного пакета.

<h3>Встроенные переменные TRUE, FALSE, NULL</h3>
Встроенные переменные PHP TRUE, FALSE and NULL должны быть написаны в нижнем регистре.
<br>

<hr><h2><a name="11">Формат файлов</a></h2>
Все скрипты должны быть сохранены в файле с расширением ".php" как ASCII текст в кодировке Windows-1251.<br>
Для переноса строк используется символ '\r\n'. Если PHP теги являются началом и/или концом файла, то старайтесь не делать переноса строк и пробелов перед и после них.
<br>

<hr><h2><a name="12">Шаблоны</a></h2>
Существует два типа шаблонов: <br> <i>1. Активные </i> - которые отвечают за загрузку модуля.<br> <i>1. Пассивные</i> - которые получают и подготавливают информацию, полученную от модуля, к выводу.<br><br>
Для разделения активных и пассивных шаблонов введен специальный префикс "act.". Так, имена активных шаблонов имеют вид: <i>'act.секция.действие.tpl'</i>, пассивных же: <i>'модуль.действие.tpl'</i>. <br>Активные шаблоны обычно содержат две строки (квадратными скобками выделены необязательные аргументы):
<div class="example">
<pre>
{* main="шаблон-получатель" placeholder="место, предназначенное для вставки результата работы пассивного шаблона" *}
{load module="модуль" action="действие" [section="секция"] [args="аргументы"]}
</pre>
</div>
Первая строка должна начинаться строго с открывающейся фигурной скобки "{", звездочки "*", одного пробела " " и описывает место и шаблон в которое будет вставлен результат. Вторая строка отвечает за получения результата выполнения модуля и имеет вид в соответствии с пассивным шаблоном.<br>
Допускается неограниченая вложенность как активных, так и пассивных шаблонов.
<br><br>
<hr>
<div align="right">
<i>Редакция от 1 сентября 2006, основано на <a href="http://pear.php.net">"PEAR Coding Standards"</a></i>
</div>
</body>
</html>